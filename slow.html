<!doctype html>
<html>
<head>

<script>
document.getElementById = function(id) {
	for(i = document.getElementsByTagName("*").length-1; i>=0; i--) {
		var tag = document.getElementsByTagName("*")[i];
		if (tag.id === id) {
			return document.getElementsByTagName("*")[i];
		}
	}
	return null;
}
</script>	

<script>

var direction = +2;

function animate() {
  var i = 0;
  var interval = setInterval(function () {
    document.getElementById('box').style.top = 
      parseInt(window.getComputedStyle(document.getElementById('box')).top) + direction + 'px';
    document.getElementById('box').style.left = 
      parseInt(window.getComputedStyle(document.getElementById('box')).left) + direction + 'px';

    // change colors too
    var boxEl = document.getElementById('box');
    var childNodes = boxEl.childNodes;
    for (var j=0; j < childNodes.length; j++) {
    	var row = childNodes.item(j);
        var divEl = row.childNodes;
		for (var k=0; k < divEl.length; k++) {
		  	var style = divEl.item(k).style;
			var background = style["background-color"];
			var arr = background.split(/,/);
			var r = arr[0].replace(/rgb\(/, "");
			var g = arr[1];
			var b = arr[2];
			
			r = parseInt(r);
			g = parseInt(g);
			b = parseInt(b);
			
			r = upDown(divEl.item(k), 'r', r);
			g = upDown(divEl.item(k), 'g', g);
			b = upDown(divEl.item(k), 'b', b);
			
			style["background-color"] = "rgb(" + r + ", " + g + ", " + b + ")";
		}
    }

    if(++i % 128 === 0) {
      direction = direction * -1;
    }
  }, 1000 / 128);
}

function upDown(divEl, RorGorB, val){
	var direction = divEl["data-" + RorGorB];
	var newVal = val;
	if (direction && direction === "up") {
			newVal = newVal + 5;
	} else {
		newVal = newVal - 5;
	}
	
	if (newVal > 255)
		divEl["data-" + RorGorB] = "down";
	if (newVal < 0) 
		divEl["data-" + RorGorB] = "up";
		
	return newVal;
}

function moreText() {
  var initialHeight = parseInt(window.getComputedStyle(document.getElementById('box')).height);
  for(var i = 0; i < 100; i++) {
    var before = document.getElementById('box').innerHTML;
    document.getElementById('box').innerHTML += 'ABC<br>';
    if(parseInt(window.getComputedStyle(document.getElementById('box')).height) > initialHeight) {
      document.getElementById('box').innerHTML = before;
    }
  }
}

// Make sure we save our state to disk
window.onmousemove = function() {
  if(window.localStorage) {
    var pos = {
      x: document.getElementById('box').style.left,
      y: document.getElementById('box').style.top,
    }
    window.localStorage.setItem('position', JSON.stringify(pos));
  }
}

</script>
</head>
<body onload="animate()">
<script>

var width  = 64,
    height = 64;

document.write('<div id="box" style="position: absolute; top: 10px; left: 10px;">');
for(var x = 0; x < width; x++) {
    document.write('<div>');
    for(var y = 0; y < height; y++) {
        var isBorder = x === 0 || x === (width - 1) || y === 0 || y === (height - 1);
        document.write('<div style="float: left; width: 1px; height: 1px; overflow: hidden; background: rgb(' + (isBorder ? 0 : 255) + ', ' + Math.round(x * 255 / width) + ', ' + Math.round(y * 255 / height) + ');"></div>');
    }
    document.write('<div style="clear: both;"></div>');
    document.write('</div>');
}
document.write('</div>');

</script>
</body>
</html>
